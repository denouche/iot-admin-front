angular.module("applications",["iot-admin-api-module"]).config(["$routeProvider",function(a){"use strict";a.when("/applications",{templateUrl:"app/components/applications/applications-view.html",controller:"ApplicationsController"})}]),angular.module("navbar",[]),angular.module("iot-admin-api-module",[]),angular.module("iot-admin-api-module").service("IotAminApiService",["Configuration","$http",function(a,b){"use strict";this.createApplication=function(){return b({method:"POST",url:a.apiBasePath+"/applications",data:{name:"New application"}}).then(function(a){return a.data})},this.deleteApplication=function(c){return b({method:"DELETE",url:a.apiBasePath+"/applications/"+c}).then(function(a){return a.data})},this.modifyApplication=function(c){return b({method:"PUT",url:a.apiBasePath+"/applications/"+c._id,data:c}).then(function(a){return a.data})},this.getApplications=function(){return b({method:"GET",url:a.apiBasePath+"/applications"}).then(function(a){return a.data})},this.getApplicationVersions=function(c){return b({method:"GET",url:a.apiBasePath+"/applications/"+c+"/versions"}).then(function(a){return a.data})},this.getApplicationDevices=function(c){return b({method:"GET",url:a.apiBasePath+"/applications/"+c+"/devices"}).then(function(a){return a.data})},this.addVersion=function(c){var d=new FormData;return c.firmware&&d.append("firmware",c.firmware),d.append("name",c.name),d.append("plateform",c.plateform),d.append("application",c.application),b({method:"POST",url:a.apiBasePath+"/versions",data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return a.data})},this.modifyVersion=function(c){var d=new FormData;return c.firmware&&d.append("firmware",c.firmware),d.append("name",c.name),d.append("plateform",c.plateform),d.append("application",c.application),b({method:"PUT",url:a.apiBasePath+"/versions/"+c._id,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return a.data})},this.downloadVersion=function(c){return b({method:"GET",url:a.apiBasePath+"/versions/"+c+"/download",headers:{accept:"application/octet-stream"},responseType:"arraybuffer"}).then(function(a){return a.data})},this.deleteVersion=function(c){return b({method:"DELETE",url:a.apiBasePath+"/versions/"+c}).then(function(a){return a.data})},this.searchDevices=function(c){return b({method:"GET",url:a.apiBasePath+"/devices",params:{application:c}}).then(function(a){return a.data})},this.deleteDevice=function(c){return b({method:"DELETE",url:a.apiBasePath+"/devices/"+c}).then(function(a){return a.data})}}]),angular.module("applications").directive("fileModel",["$parse",function(a){"use strict";return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]),angular.module("applications").controller("ApplicationsController",["$scope","IotAminApiService","Alerter","$timeout",function(a,b,c,d){"use strict";function e(){a.model.loadingApplications=!0,b.getApplications().then(function(b){a.model.availableApplications=_.forEach(b,function(a){a.metadata={isOpen:!1,edition:!1}}),a.model.loadingApplications=!1,console.log("availableApplications",b)},function(a){console.error(a)}),b.searchDevices("").then(function(b){console.log("ici",b),b.length>0&&(a.model.unlinkedDevices.has=!0,d(a.selectApplication))},function(a){console.error(a),c.error("Une erreur est survenue lors du chargement des informations")})}a.model={availableApplications:[],loadingApplications:!1,selected:{application:null},unlinkedDevices:{has:!0,open:!0}},e(),a.selectApplication=function(b){a.model.selected.application=b,a.selectTab("devices")},a.selectTab=function(b){a.$broadcast("events.application.tab."+b,a.model.selected.application)},a.createApplication=function(){b.createApplication().then(function(){c.success("Application créée"),e()},function(a){console.error(a),c.error("Une erreur est survenue lors de la création de l'application")})},a.deleteApplication=function(a){a.metadata.isOpen=!a.metadata.isOpen,a.metadata.isOpen=!a.metadata.isOpen,b.deleteApplication(a._id).then(function(){c.success("Application supprimée"),e()},function(a){console.error(a),c.error("Une erreur est survenue lors de la suppression de l'application")})},a.editApplication=function(a){a.metadata.edition=!0,a.metadata.newName=a.name},a.saveEdition=function(a){a.name=a.metadata.newName,b.modifyApplication(a).then(function(){c.success("Application modifiée"),e()},function(a){console.error(a),c.error("Une erreur est survenue lors de la modification de l'application")})},a.cancelEdition=function(a){a.metadata.edition=!1}}]),angular.module("applications").controller("ApplicationDevicesController",["$scope","IotAminApiService","Alerter",function(a,b,c){"use strict";function d(){b.getApplicationVersions(a.model.devices.application._id).then(function(b){a.model.devices.availableDevices.forEach(function(a){a.metadata||(a.metadata={});var c=_.find(b,{_id:a._version,plateform:a.plateform});c&&(a.metadata.version=c)})},function(a){console.error(a),c.error("Une erreur est survenue lors du chargement des informations")})}function e(){a.model.devices.availableDevices=null,b.getApplicationDevices(a.model.devices.application._id).then(function(b){a.model.devices.availableDevices=b,d()},function(a){console.error(a),c.error("Une erreur est survenue lors du chargement des informations")})}function f(){b.searchDevices("").then(function(b){a.model.devices.availableDevices=b},function(a){console.error(a),c.error("Une erreur est survenue lors du chargement des informations")})}a.model.devices={application:null,availableDevices:null},a.$on("events.application.tab.devices",function(b,c){a.model.devices.application=c,a.application&&a.application._id&&a.model.devices.application&&a.model.devices.application._id&&a.application._id===a.model.devices.application._id?e():a.application||c||f()}),a.deleteDevice=function(a){b.deleteDevice(a._id).then(function(){c.success("Device supprimé avec succès"),e()},function(a){console.error("Error while deleting device",a),c.error("Une erreur est survenue lors de la suppression du device")})}}]),angular.module("applications").controller("ApplicationVersionsController",["$scope","IotAminApiService","Alerter","FileSaver",function(a,b,c,d){"use strict";function e(){a.model.versions.availableVersions=null,b.getApplicationVersions(a.model.versions.application._id).then(function(b){b.forEach(function(a){a.metadata={edition:!1}}),b.sort(function(a,b){return compareVersions(b.name,a.name)}),a.model.versions.availableVersions=_.groupBy(b,"name")},function(a){console.error(a),c.error("Une erreur est survenue lors du chargement des informations")})}a.model.availableVersions=null,a.model.versions={application:null,availablePlateforms:["esp8266","raspberry"],availableVersions:null,inlineAdd:!1,toAdd:null},a.$on("events.application.tab.versions",function(b,c){a.model.versions.application=c,a.application&&a.application._id&&a.model.selected.application&&a.model.selected.application._id&&a.application._id===a.model.selected.application._id&&e()}),a.showInlineAdd=function(){a.model.versions.toAdd={},a.model.versions.inlineAdd=!0},a.resetInlineAdd=function(){angular.element(document.querySelector("#versionsToAddFirmware")).val(null),a.model.versions.toAdd={},a.model.versions.inlineAdd=!1},a.saveInlineAdd=function(){a.model.versions.toAdd.application=a.model.versions.application.name,b.addVersion(a.model.versions.toAdd).then(function(){c.success("Version ajoutée avec succès"),e(),a.resetInlineAdd()},function(a){console.error("Error while saving version",a),c.error("Une erreur est survenue lors de la création de la version")})},a.downloadVersion=function(e){b.downloadVersion(e._id).then(function(b){var c=new Blob([b],{type:"application/octet-stream"});d.saveAs(c,[a.model.versions.application.name,e.name,e.plateform].join("_")+".bin")},function(a){console.error("Error while downloadVersion",a),c.error("Une erreur est survenue lors du téléchargement du firmware de la version")})},a.deleteVersion=function(a){b.deleteVersion(a._id).then(function(){c.success("Version supprimée avec succès"),e()},function(a){console.error("Error while deleting version",a),c.error("Une erreur est survenue lors de la suppression de la version")})},a.editVersion=function(a){a.metadata.edition=!0},a.resetVersionEdition=function(a){a.firmware=null,angular.element(document.querySelector("#versionToEditFirmware-"+a._id)).val(null),a.metadata.edition=!1},a.saveVersion=function(d){b.modifyVersion(d).then(function(){c.success("Version ajoutée avec succès"),e(),a.resetInlineAdd()},function(a){console.error("Error while saving version",a),c.error("Une erreur est survenue lors de la création de la version")})}}]),angular.module("navbar").controller("NavbarController",["$scope","$location",function(a,b){"use strict";a.isSectionActive=function(a){return!!new RegExp("^/"+a+"(?:/.*|)").test(b.path())}}]),angular.module("iotAdminApplication",["pascalprecht.translate","configVersion","tmh.dynamicLocale","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ngFileSaver","toastr","utils","config","templates-app","applications"]).config(["$routeProvider",function(a){"use strict";a.otherwise({redirectTo:"applications"})}]).config(["$translateProvider","Configuration","$translatePartialLoaderProvider",function(a,b,c){"use strict";c.addPart("main"),a.useLoader("$translatePartialLoader",{urlTemplate:"assets/i18n/{part}/{lang}.json"}),a.registerAvailableLanguageKeys(["fr-fr","en-gb"],{"en*":"en-gb","fr*":"fr-fr","*":"en-gb"}).determinePreferredLanguage().fallbackLanguage(b.defaultlanguage),a.useSanitizeValueStrategy("escape")}]).config(["tmhDynamicLocaleProvider","Configuration",function(a,b){"use strict";a.defaultLocale(b.defaultlanguage),a.localeLocationPattern("assets/libs/angular-i18n/angular-locale_{{locale}}.js")}]).run(["$rootScope","$translate","tmhDynamicLocale",function(a,b,c){"use strict";a.$on("$translatePartialLoaderStructureChanged",function(){b.refresh()}),a.$on("$translateChangeSuccess",function(a,b){c.set(b.language)})}]).run(["$rootScope","VERSION",function(a,b){"use strict";a.VERSION=b}]),angular.module("templates-app",["app/components/applications/applications-view.html","app/components/applications/devices/devices-view.html","app/components/applications/versions/versions-view.html","app/components/navbar/navbar-view.html"]),angular.module("app/components/applications/applications-view.html",[]).run(["$templateCache",function(a){a.put("app/components/applications/applications-view.html",'<div><p>Applications list : <button type="button" class="btn btn-default btn-sm" data-ng-click="createApplication()"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Create</button></p><uib-accordion><div data-uib-accordion-group data-ng-show="model.unlinkedDevices.has" class="panel-default" data-is-open="model.unlinkedDevices.open"><div data-uib-accordion-heading><div data-ng-click="selectApplication()"><span>Unassociated applications</span> <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': model.unlinkedDevices.open, \'glyphicon-chevron-right\': !model.unlinkedDevices.open}"></i></div></div><div data-ng-include="\'app/components/applications/devices/devices-view.html\'"></div></div><div data-uib-accordion-group data-ng-repeat="application in model.availableApplications" class="panel-default" data-is-open="application.metadata.isOpen" data-ng-show="!model.loadingApplications"><div data-uib-accordion-heading><div data-ng-click="selectApplication(application)" data-ng-mouseover="application.metadata.isOver = true" data-ng-mouseleave="application.metadata.isOver = false" class="form-inline"><span data-ng-if="!application.metadata.edition">{{application.name}}</span> <span data-ng-if="application.metadata.edition"><input type="text" data-ng-model="application.metadata.newName" data-ng-click="$event.stopPropagation();$event.preventDefault()" class="form-control"> <button type="button" data-ng-click="$event.stopPropagation();$event.preventDefault();saveEdition(application)" data-ng-show="application.metadata.edition" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-ok"></span></button> <button type="button" data-ng-click="$event.stopPropagation();$event.preventDefault();cancelEdition(application)" data-ng-show="application.metadata.edition" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-remove"></span></button> </span><i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': application.metadata.isOpen, \'glyphicon-chevron-right\': !application.metadata.isOpen}"></i> <button type="button" data-ng-click="$event.stopPropagation();$event.preventDefault();deleteApplication(application)" data-ng-show="application.metadata.isOver" class="pull-right btn btn-default btn-xs"><span class="glyphicon glyphicon-trash"></span></button> <button type="button" data-ng-click="$event.stopPropagation();$event.preventDefault();editApplication(application)" data-ng-show="application.metadata.isOver" class="pull-right btn btn-default btn-xs"><span class="glyphicon glyphicon-pencil"></span></button></div></div><uib-tabset active="active"><uib-tab index="0" heading="Devices" data-select="selectTab(\'devices\')"><div data-ng-include="\'app/components/applications/devices/devices-view.html\'"></div></uib-tab><uib-tab index="1" heading="Versions" data-select="selectTab(\'versions\')"><div data-ng-include="\'app/components/applications/versions/versions-view.html\'"></div></uib-tab></uib-tabset></div></uib-accordion></div>')}]),angular.module("app/components/applications/devices/devices-view.html",[]).run(["$templateCache",function(a){a.put("app/components/applications/devices/devices-view.html",'<div data-ng-controller="ApplicationDevicesController"><div class="col-md-1 loader" data-ng-show="!model.devices.availableDevices" data-ng-include="\'assets/images/loader-grey.svg\'"></div><table class="table table-hover" data-ng-show="model.devices.availableDevices"><thead><tr><th>Mac</th><th>Version</th><th>Plateform</th><th>SSID</th><th>IP</th><th>Last register</th><th>Comment</th><th></th></tr></thead><tbody><tr data-ng-repeat="device in model.devices.availableDevices"><td data-ng-bind="device.mac"></td><td data-ng-bind="device.metadata.version.name"></td><td data-ng-bind="device.plateform"></td><td data-ng-bind="device.ssid"></td><td data-ng-bind="device.ip"></td><td>{{device.last_register | date:\'shortDate\'}} {{device.last_register | date:\'mediumTime\'}}</td><td data-ng-bind="device.comment"></td><td><button type="button" class="btn btn-default btn-xs" data-ng-click="deleteDevice(device)"><span class="glyphicon glyphicon-trash"></span></button></td></tr></tbody></table></div>')}]),angular.module("app/components/applications/versions/versions-view.html",[]).run(["$templateCache",function(a){a.put("app/components/applications/versions/versions-view.html",'<div data-ng-controller="ApplicationVersionsController"><table class="table table-hover"><thead><tr><th>Version</th><th>Plateform</th><th></th><th style="width: 110px"></th></tr></thead><tbody data-ng-show="!model.versions.availableVersions"><tr><td colspan="4"><div class="col-md-1 loader" style="width: 100%" data-ng-include="\'assets/images/loader-grey.svg\'"></div></td></tr></tbody><tbody data-ng-show="model.versions.availableVersions"><tr data-ng-show="!model.versions.inlineAdd" data-ng-click="showInlineAdd()" class="info inline-add"><td colspan="3">Click here to add a version</td><td><span class="glyphicon glyphicon-plus"></span></td></tr><tr data-ng-show="model.versions.inlineAdd" class="info"><td><input type="text" data-ng-model="model.versions.toAdd.name" placeholder="1.2.3" class="form-control"></td><td><select class="form-control" data-ng-options="plateform as plateform for plateform in model.versions.availablePlateforms" data-ng-model="model.versions.toAdd.plateform"></select></td><td><input type="file" id="versionsToAddFirmware" data-file-model="model.versions.toAdd.firmware"></td><td><button type="button" class="btn btn-default btn-xs" data-ng-click="saveInlineAdd()"><span class="glyphicon glyphicon-ok"></span></button> <button type="button" class="btn btn-default btn-xs" data-ng-click="resetInlineAdd()"><span class="glyphicon glyphicon-remove"></span></button></td></tr></tbody><tbody data-ng-show="model.versions.availableVersions" data-ng-repeat="(name, versions) in model.versions.availableVersions"><tr data-ng-repeat="version in versions | orderBy:\'plateform\'"><td data-ng-bind="name"></td><td data-ng-bind="version.plateform"></td><td class="text-right"><span data-ng-if="version.metadata.edition"><input type="file" id="versionToEditFirmware-{{version._id}}" data-file-model="version.firmware" style="display: inline"> <button type="button" class="btn btn-default btn-xs" data-ng-click="saveVersion(version)"><span class="glyphicon glyphicon-ok"></span></button> <button type="button" class="btn btn-default btn-xs" style="margin-right: 30px" data-ng-click="resetVersionEdition(version)"><span class="glyphicon glyphicon-remove"></span></button> </span><button type="button" class="btn btn-default btn-xs" data-ng-click="downloadVersion(version)" data-ng-disabled="!version.hasFirmware" data-uib-tooltip="Download the firmware"><span class="glyphicon glyphicon-download"></span></button> <button type="button" class="btn btn-default btn-xs" data-ng-click="editVersion(version)" data-uib-tooltip="Upload a new firmware for this version and plateform"><span class="glyphicon glyphicon-upload"></span></button></td><td><button type="button" class="btn btn-default btn-xs" data-ng-click="deleteVersion(version)"><span class="glyphicon glyphicon-trash"></span></button></td></tr></tbody></table></div>')}]),angular.module("app/components/navbar/navbar-view.html",[]).run(["$templateCache",function(a){a.put("app/components/navbar/navbar-view.html",'<nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><span class="navbar-brand" data-translate="navbar.title"></span></div><div class="collapse navbar-collapse"><p class="navbar-text navbar-right">v{{VERSION}}</p></div></div></nav>')}]),angular.module("configVersion",[]).constant("VERSION","0.3.3"),angular.module("config",[]).constant("Configuration",{defaultlanguage:"en-gb",apiBasePath:"/api"});